import{createContext as e,useState as a,useContext as n,useEffect as t,Children as r,cloneElement as o}from"react";import l from"firebase/app";import{useSearchParam as u}from"react-use";import"firebase/database";import i from"oboe";var m=e(null),f=function(e){var a=e.children;return l.apps.length||l.initializeApp(e.firebaseConfig),h(m.Provider,{value:l},a)};function c(e){for(var a=e.length-1;a>0;a--){var n=Math.floor(Math.random()*(a+1)),t=[e[n],e[a]];e[a]=t[0],e[n]=t[1]}return e}var s=require("./adjectives.data"),p=require("./nouns.data");require("./intro.scss");var d=function(e){var a=e.playerName,n=e.setPlayerName,t=e.setGameId,r=e.onStart,o=e.gameIntro;return h("intro-block",null,h("h2",null,"Welcome"),o,h(y,{playerName:a,setPlayerName:n,setGameId:t,onStart:r}))},y=function(e){var r=e.playerName,o=e.setPlayerName,l=e.setGameId,u=a(""),f=u[0],d=u[1],y=a(!1),g=y[0],v=y[1],b=a([]),N=b[0],S=b[1],I=a([]),C=I[0],P=I[1],k=a(0),G=k[0],R=k[1],j=n(m),q=function(){""!==f&&""!==r?Promise.resolve().then(function(){v(!0)}).then(function(){return j.database().ref("/"+f+"/players")}).then(function(e){return e.push({name:r})}).then(function(){return l(f)}):alert("You need both a name and gameId")};return t(function(){i(s).done(function(e){S(c(e))}).fail(function(e){console.warn(e)}),i(p).done(function(e){P(c(e))}).fail(function(e){console.warn(e)})},[]),h(Fragment,null,h("input",{type:"text",placeholder:"Your name",value:r,onChange:function(e){return o(e.target.value)}}),h("input",{type:"text",placeholder:"Enter the game code",value:f,onChange:function(e){return d(e.target.value)},onKeyPress:function(e){"Enter"==e.key&&q()}}),!g&&h(Fragment,null,h("button",{onClick:function(){return e=N[G],a=C[G],R(G+1),void d(e+"-"+a);var e,a}},"Suggest random game code"),h("button",{onClick:function(){return q()}},"Play!")))},g=function(e){var a=e.gameState,n=e.gameRef,t=e.playerName,r=e.onStart;return a.players?h("players-list",null,h("h2",null,"Waiting to play"),Object.entries(a.players).map(function(e){var r=e[0],o=e[1];return h("label",{key:o.name},h("player-name",null,o.name," is ",o.ready?"ready":"not ready"),o.name===t&&h("button",{onClick:function(){return(t=a.players)[e=r].ready=!t[e].ready,void n.update({players:t});var e,t}},"Toggle if Ready"))}),h("button",{onClick:function(){Object.values(a.players).some(function(e){return!e.ready})?alert("Someone isn't ready"):r({gameRef:n,gameState:a,playerName:t})},disabled:Object.values(a.players).some(function(e){return!e.ready})},"Start Game")):h("players-list",null," No players yet ")},v=function(e){var l=e.gameId,u=e.playerName,i=e.children,f=e.onStart,c=n(m),s=a({}),p=s[0],d=s[1],y=a(),v=y[0],b=y[1];return t(function(){var e=c.database().ref("/"+l+"/");b(e),e.on("value",function(e){d(e.val())})},[]),h("game-container",null,h("game-title",null,"Game Id - ",l," - playing as ",u," ",h("a",{href:"/"},"New Game")),p.active?r.map(i,function(e){return o(e,{gameState:p,gameRef:v,playerName:u})}):h(g,{gameState:p,gameRef:v,playerName:u,onStart:f}))};export default function(e){var n=e.children,t=e.onStart,r=void 0===t?function(){}:t,o=e.gameIntro,l=e.firebaseConfig,i=a(u("game")||""),m=i[0],c=i[1],s=a(u("name")||""),p=s[0],y=s[1];return h(f,{firebaseConfig:l},m?h(v,{gameId:m,playerName:p,onStart:r},n):h(d,{playerName:p,setPlayerName:y,setGameId:c,gameIntro:o}))}
//# sourceMappingURL=index.esm.js.map
